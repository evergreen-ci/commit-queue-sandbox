## this is a change
ignore:
  - "*.md" # dont schedule tests if a commit only changes markdown files
stepback: true

pre: &pre
  - command: git.get_project
    params:
      directory: src
  - func: create virtualenv

post:
  - command: attach.xunit_results
    params:
      file: src/junit-*.xml

functions:
  create virtualenv:
    - command: shell.exec
      params:
        working_dir: src
        script: |
          echo "noop"
          git describe


buildvariants:
  - display_name: Generate Tasks for Version
    name: generate-tasks-for-version
    run_on:
      - ubuntu1604-test
    tasks:
      - name: version_gen

  - display_name: TestBV1
    name: testBV1
    run_on:
      - ubuntu1604-test
    tasks:
      - name: placeholder
    depends_on:
      - name: version_gen
        variant: generate-tasks-for-version
        omit_generated_tasks: true

  - name: testBV2
    display_name: TestBV2
    run_on:
      - ubuntu1604-test
    tasks:
      - name: dependencyTask
      - name: placeholder

  - name: testBV3
    display_name: TestBV3
    run_on:
      - ubuntu1604-test
    tasks:
      - name: placeholder
    depends_on:
      - name: version_gen
        variant: generate-tasks-for-version
      - name: dependencyTask
        variant: testBV4

  - name: testBV4
    display_name: TestBV4
    run_on:
      - ubuntu1604-test
    tasks:
      - name: dependencyTask

tasks:
  - name: placeholder
    depends_on:
      - name: version_gen
        variant: generate-tasks-for-version
    commands:
      - command: shell.exec
        params:
          working_dir: src
          script: |
            echo "noop2"

  - name: dependencyTask
    commands:
      - command: shell.exec
        params:
          script: |
            echo "noop2"

  - name: version_gen
    commands:
      - command: generate.tasks
        params:
          files:
            - src/evergreen.json
